#!/usr/bin/env bash
# Heroku post-compile hook
# This script runs after the build is complete but before the slug is created

echo "-----> Generating build-time version information"

# Create version.json with build-time information only
# Note: HEROKU_* runtime variables are not available at build time
cat > version.json << EOF
{
  "git_hash": "${SOURCE_VERSION:-unknown}",
  "git_hash_full": "${SOURCE_VERSION:-unknown}",
  "build_time": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
  "stack": "${STACK:-unknown}"
}
EOF

echo "-----> Build-time version information generated"
cat version.json
